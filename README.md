# Highspell Online Members Bot
A simple discord to periodically fetch online member count from [Highspell main page](https://highspell.com) and update a discord message.

## Setup and Usage
This is a simple node.js application. Clone the repository, run `npm install` in the directory, and then run `node index.js` to start the bot.

## Config
Config is a simple JSON file. Copy `config.dev.json` to `config.json` and edit values as appropriate.
```
{
    token,
    pollRate,
    channelId,
    totalCount: {
        url,
        cssSelector,
        negativeCssSelector,
        subCssSelector
    },
    worldsCount: {
        url,
        cssSelector,
        negativeCssSelector,
        subCssSelector
    }
    embed
}
```
- `token` **Requried**: Discord bot token to log in with
- `pollRate` **Required**: Number of seconds between updates. Each update fetches the page and updates the discord message
- `channelId` **Required**: Discord ChannelId
- `totalCount` *Optional*: If present, provides config for fetching the total member count from the Highspell main page.
    - `url` **Required**: Exact URL to fetch page from
    - `cssSelector` **Required**: A standard [CSS Selector](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_selectors) used to extract the member count from the page
    - `negativeCssSelector` *Optional*: A CSS Selector to exclude elements fetched by `cssSelector`. This is useful for excluding elements that are not part of the member count.
    - `subCssSelector` *Optional*: A CSS Selector to further narrow down the selection of elements fetched by `cssSelector` after applying `negativeCssSelector`. This is useful for cases where the member count is nested within other elements.
- `worldsCount` *Optional*: If present, provides config for fetching the total member count from the Highspell main page.
    - `url` **Required**: Exact URL to fetch page from
    - `cssSelector` **Required**: A standard [CSS Selector](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_selectors) used to extract the member count from the page
    - `negativeCssSelector` *Optional*: A CSS Selector to exclude elements fetched by `cssSelector`. This is useful for excluding elements that are not part of the member count.
    - `subCssSelector` *Optional*: A CSS Selector to further narrow down the selection of elements fetched by `cssSelector` after applying `negativeCssSelector`. This is useful for cases where the member count is nested within other elements.
- `embed` *Optional*: Any custom parameters for the message embed. See [discord.js docs](https://discordjs.guide/popular-topics/embeds.html#using-an-embed-object) for details on accepted properties.

### Default Embed settings
These properties, plus any omitted properties, will be overridden by provided properties in the config file
```
{
    color: 0x0099ff,
    title: 'Online Players',
    url: config.url,
    description: `Current member count: ${memberCount}`,
    timestamp: new Date().toISOString(),
    fields: <world specific fields if `config.worldsCount` is set>
}
```
It is not recommended to override `description` or `timestamp`, as values provided in the config file are constant and cannot be evaluated at runtime.
Any `fields` specified in the config file will be added to fields generated by `config.worldsCount`.
